---
title: "분산 스토리지 비교: Longhorn vs Rook/Ceph"
date: 2024-01-01T00:00:00+09:00
draft: false
categories:
    - study
    - infra
tags:
    - kubernetes
    - storage
    - longhorn
    - ceph
    - rook
    - distributed-storage
    - on-premise
description: "Kubernetes 환경에서 Longhorn과 Rook/Ceph 분산 스토리지 솔루션 비교 및 선택 가이드"
---

알겠습니다. On-Premise(직접 구축) 또는 베어메탈 환경에서 가장 많이 비교되는 두 가지 대표적인 스토리지 솔루션, **Longhorn**과 **Rook/Ceph**를 중심으로 자세히 비교 설명해 드리겠습니다.

이 둘은 k8s 클러스터의 각 노드에 있는 로컬 디스크(또는 연결된 디스크)를 묶어서, 사용자가 원했던 **"여러 노드에 걸쳐 데이터를 안전하게 분산/복제하는"** (마치 멀티 노드 RAID처럼) 가상 스토리지 풀을 만드는 솔루션입니다.

-----

## 🚀 Longhorn vs. Rook/Ceph 비교

두 솔루션의 가장 큰 차이점은 \*\*단순성(Longhorn)\*\*과 \*\*기능 범위(Ceph)\*\*에 있습니다.

| 비교 항목 | 🐄 Longhorn (롱혼) | 🐙 Rook + Ceph (루크 + 셰프) |
| :--- | :--- | :--- |
| **핵심 컨셉** | 사용하기 쉬운 **분산 블록 스토리지** | 모든 것을 제공하는 **통합 분산 스토리지** |
| **설치/운영** | **매우 쉬움.** (Helm 차트 10분) <br> 뛰어난 GUI 대시보드 제공 | **복잡함.** <br> Ceph의 개념(OSD, MON 등) 이해 필요 |
| **주요 기능** | **블록 스토리지 (RWO)** <br> (iSCSI 방식의 제한적 RWX) | **블록(RBD)**, **파일(CephFS)**, **오브젝트(RGW)** |
| **성능** | 대부분의 앱에 충분 (Good) | 튜닝 시 매우 고성능 (Excellent) |
| **확장성** | 중소규모 클러스터에 최적 | 대규모 \~ 초거대 규모(페타바이트) |
| **안정성** | 성숙하고 안정적임 | 업계 표준. 매우 안정적 |
| **추천 대상** | **단순함**이 중요하고, 주로 **RWO**가 필요한 경우 | **RWX(파일공유)**, **오브젝트**, **고성능**이 모두 필요한 경우 |

-----

### 1\. 🐄 Longhorn (간편하고 강력한 블록 스토리지)

Longhorn은 "k8s 네이티브" 스토리지에 가장 잘 부합하는 솔루션 중 하나입니다. k8s 위에서 마이크로서비스(컨트롤러, 레플리카 인스턴스)로 실행됩니다.

  * **작동 방식:**

      * 사용자가 `StorageClass`를 통해 10GB 볼륨을 요청하면,
      * Longhorn은 지정된 노드들(예: 3개 노드)에 10GB 볼륨 복제본(replica)을 각각 생성합니다.
      * Pod가 `node-1`에서 실행되면 `node-1`의 로컬 복제본에 데이터를 씁니다.
      * 동시에 이 데이터는 `node-2`, `node-3`의 복제본으로 \*\*실시간 동기화(복제)\*\*됩니다.
      * 만약 `node-1`이 다운되면, k8s가 Pod를 `node-2`로 옮기고, Pod는 `node-2`의 복제본에 즉시 연결되어 서비스를 재개합니다.

  * **장점:**

      * **극강의 단순함:** 설치가 매우 쉽고, 제공되는 GUI 대시보드가 직관적이라 운영이 편리합니다.
      * **핵심 기능:** 스냅샷, 백업 (S3/NFS로), 복제본 수 자동 조절 등 PV 관리에 필요한 핵심 기능이 잘 갖춰져 있습니다.

  * **단점:**

      * **제한된 RWX:** 주력은 RWO(ReadWriteOnce)입니다. RWX(ReadWriteMany)를 지원하지만, 이는 모든 Pod가 하나의 '공유 볼륨'에 접근하는 NFS 방식이 아니라, 하나의 블록 볼륨을 iSCSI로 여러 노드에 연결하는 방식이라 일부 앱(예: Wordpress)에서는 사용이 까다롭거나 권장되지 않습니다.
      * **성능:** 데이터를 여러 노드에 동기 복제하므로 네트워크 지연시간만큼의 쓰기 페널티가 있습니다. 고성능 데이터베이스에는 충분하지만, 초고속 IOPS가 필요한 작업에는 Ceph보다 불리할 수 있습니다.

### 2\. 🐙 Rook + Ceph (모든 것을 다루는 스토리지 괴물)

**Ceph**는 그 자체로 매우 거대하고 복잡하지만 강력한 오픈소스 스토리지 시스템입니다. **Rook**는 이 복잡한 Ceph를 k8s 환경에서 쉽게 배포하고 관리할 수 있게 해주는 '오퍼레이터(Operator)'입니다.

  * **작동 방식:**

      * Ceph는 데이터를 블록 단위로 쪼개고(RADOS), **CRUSH 맵**이라는 알고리즘을 통해 수백, 수천 대의 노드와 디스크에 지능적으로 분산/복제/저장합니다. (RAID보다 훨씬 진보된 방식)
      * Rook는 이 Ceph 클러스터를 k8s 위에 컨테이너(Pod) 형태로 띄우고, `StorageClass` 요청이 오면 Ceph의 기능을 연결해 줍니다.

  * **장점:**

      * **모든 기능 제공 (Unified):**
        1.  **RBD (블록 스토리지):** Longhorn과 같은 RWO/RWX 블록 스토리지. (DB용)
        2.  **CephFS (파일 스토리지):** 진정한 분산 파일 시스템 (NFS처럼) RWO/RWX 지원. (웹서버 파일 공유, AI/ML 데이터셋 공유용)
        3.  **RGW (오브젝트 스토리지):** S3 API와 호환됩니다. (Minio의 역할까지 대체 가능)
      * **엄청난 확장성과 성능:** 수백 페타바이트(PB)까지 선형적으로 확장되며, SSD/NVMe와 빠른 네트워크(10GbE+)로 튜닝하면 극도로 높은 성능을 낼 수 있습니다.

  * **단점:**

      * **압도적인 복잡성:** Rook가 많이 도와주지만, Ceph는 여전히 어렵습니다. 장애 발생 시 Ceph 내부 CLI 명령어를 알아야 하는 경우가 많습니다.
      * **무거움:** 기본 설치만으로도 Longhorn보다 더 많은 리소스(CPU, Memory)를 사용합니다. 작은 클러스터에는 '닭 잡는 데 소 잡는 칼'일 수 있습니다.

-----

## 🤔 그래서, 무엇을 선택해야 할까요?

### **✅ Longhorn을 선택하세요:**

  * **"지금 당장"** 데이터베이스(PostgreSQL, MySQL, Redis 등)를 위한 **안정적인 RWO 볼륨**이 필요할 때
  * k8s 운영 외에 스토리지 운영에 큰 노력을 쏟고 싶지 않을 때
  * 직관적인 **GUI**로 스냅샷/백업을 관리하고 싶을 때
  * 클러스터 규모가 비교적 작거나(노드 3\~20개), 개발/스테이징 환경일 때

### **✅ Rook/Ceph를 선택하세요:**

  * **진정한 RWX(파일 공유)** 기능이 반드시 필요할 때 (예: 여러 워드프레스 Pod가 `wp-content`를 공유)
  * k8s 클러스터 내에서 \*\*S3 호환 오브젝트 스토리지(Minio 대체)\*\*까지 한 번에 구축하고 싶을 때
  * **초고성능 또는 대용량**이 필요한 미션 크리티컬한 서비스를 운영할 때
  * 스토리지 운영을 전담할 엔지니어가 있거나, Ceph를 학습할 의지가 있을 때

-----

### 💡 Minio와의 관계 정리

  * **Longhorn/Ceph:** Pod에 마운트되는 **디스크(블록)** 또는 \*\*공유 폴더(파일)\*\*를 제공합니다. (OS가 인식하는 스토리지)
  * **Minio:** S3 API를 통해 접근하는 **객체(파일)** 저장소입니다. (애플리케이션이 SDK로 접근)

만약 Ceph를 사용한다면 Ceph의 RGW(오브젝트 스토리지) 기능으로 Minio를 대체할 수 있습니다.
하지만 Longhorn을 사용한다면, 오브젝트 스토리지가 필요할 때 Minio를 **별도로** 설치해야 합니다. (이때 Minio의 데이터 저장용 PV로 Longhorn을 사용할 수 있습니다.)

이 비교가 스토리지 솔루션을 선택하는 데 도움이 되길 바랍니다.

혹시 Longhorn이나 Rook/Ceph의 기본 설치 과정이나 `StorageClass` 설정 예시가 궁금하신가요?